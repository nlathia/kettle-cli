# operator

Operator is a command line tool for creating and shipping machine learning deployments. You can use it to generate and deploy AWS [Lambda](https://aws.amazon.com/lambda/)s, Google [Cloud Functions](https://cloud.google.com/functions) and Google [Cloud Run](https://cloud.google.com/run) containerised applications.

This CLI has two primary commands:

* `operator create <name>` creates a directory containing all the boiler plate code that you need to get going. You just need to fill in the functions that loads the model and returns a prediction.
* `operator deploy <path>` deploys the code in that directory as a Cloud Function or Cloud Run application.

This is a pre-release alpha version of this tool. Please send any bugs or feedback.

## Pre-requisites

Operator relies on you having a few things installed already.

### AWS or Google Cloud

For AWS Lambdas:

* The [aws cli](https://aws.amazon.com/cli/).

For Google Cloud Functions:

* The [gcloud](https://cloud.google.com/sdk/gcloud) SDK
* Enable the Cloud Functions API in the GCP console
* Only http-triggered cloud functions are currently supported by this tool

For Google Cloud Run:

* The [gcloud](https://cloud.google.com/sdk/gcloud) SDK
* Enable the Cloud Run API in the GCP console
* [Optional] [Docker](https://docs.docker.com/get-docker/) to build and run Cloud Run containerized applications locally.
* Only http-triggered cloud functions are currently supported by this tool

### Programming Languages

For Python deployments:

* Both [pyenv](https://github.com/pyenv/pyenv) and [pyenv-virtualenv](https://github.com/pyenv/pyenv-virtualenv): the boiler plate generated by this tool enables you to create Python virtual environments, but assumes you have these tools installed already.

For Go deployments:

* Go version 1.13

## Installing with brew

You can install `operator` using `brew` and [the operatorai tap](https://github.com/operatorai/homebrew-tap).

```bash
❯ brew tap operatorai/tap
❯ brew install operator
```

## Usage

First, set up the CLI tool using `operator init`. It will take you through a one-off set up, and store your preferences.

```bash
❯ operator init
[...]
Use the arrow keys to navigate: ↓ ↑ → ← 
? Deployment type: 
  ▸ Google Cloud Function
    Google Cloud Run
```

Create a new deployment with `operator create` (check out `operator create --help` for a full list of options).

```bash
❯ operator create hello-world
```

This will create a directory called (in this example) `hello-world` and it will add all the boiler plate you need to get going. For details about the generated boiler plate, see below.

You can now change into the `hello-world` directory, and use the `make install` command to create a `pyenv` virtual environment for your deployment.

```bash
❯ cd hello-world
❯ make install # To create a pyenv-virtualenv
```

Launch it locally:

```bash
❯ make localhost
```

... and, when you're ready, deploy it!

```bash
❯ operator deploy .
```

## Generated Python boiler plate

The boiler plate that is generated is very similar all deployment types. The main differences are whether a `Dockerfile` gets created, and there is different syntax in the `main.py` files.

An overview of the files that are shared in the template:

```bash
.
├── Makefile
├── README.md
├── bin  # Scripts that are used by the Makefile commands
│   ├── _config.sh
│   ├── cleanup.sh
│   ├── launch.sh
│   ├── remove_pyenv.sh
│   └── setup_pyenv.sh
├── main.py
├── model
│   ├── __init__.py
│   ├── artifacts # Store your serialised models in this directory
│   │   ├── README.md
│   │   ├── __init__.py
│   │   └── files.py
│   └── model.py
├── operator.config
├── requirements-dev.txt # Requirements that are needed for development
├── requirements.txt # Requirements that are needed for the production deployment
└── tests # Unit tests!
    ├── __init__.py
    └── model
        ├── __init__.py
        ├── artifacts
        │   ├── __init__.py
        │   └── test_files.py
        └── test_model.py
```

## Bug Reports

Please report any bugs or issues to me (neal.lathia@gmail.com) or by raising an issue in this repo.
